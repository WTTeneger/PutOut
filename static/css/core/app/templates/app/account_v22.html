{% extends 'app/base.html' %}
{% load i18n %}
{% load static %}

{% block title %}
LuckyTrader - {% translate "Приборная панель" %}
{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/general-page.css' %}" type="text/css">
<script src="{% static '/js/tblock.js' %}"></script>
<link href="{% static 'css/catalog-page.css' %}" rel="stylesheet">

{% endblock %}

{% block content %}
<main class="page-account__main">
    <section class="section-catalog-info">
        <div class="section-catalog-info__logo">
            <img src="{% static 'img/logo/logo-small.svg' %}" alt="Lucky Trade Logo">
        </div>
        <div class="section-catalog-info__info">
            <h1 class="section-catalog-info__title">{% translate "Копитрейдинг" %}</h1>
            <p class="section-catalog-info__text">{% trans 'Следуйте стратегии, чтобы начать копировать ее сделки' %}</p>
        </div>
    </section>
    <section class="section-top-strategies">
        <h2 class="section-top-strategies__title">{% translate "Лучшие стратегии" %}</h2>
        <div class="section-top-strategies__top-strategies-wrapper">
            <ul class="section-top-strategies__top-strategies top-strategies">
                {% for el in topstrategyes %}
                <a href="{% url 'appStrategyId' el.id %}" orders="{{el.stats.all_ROE}}" class="top-strategies__item">
                    <p class="top-strategies__verification">{% translate "Верифицированный трейдер" %}</p>
                    <h3 class="top-strategies__title">
                        <img src="{% static 'img/icons/checkmark-2.svg' %}" alt="Checkmark Icon">
                        {{el.title}}
                    </h3>
                    <ul class="top-strategies__info">
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Биржа" %}</p>
                            <p class="top-strategies__info-value">
                                <img src="{% static 'img/icons/binance-2.svg' %}" alt="Binance logo">
                                {{el.platforms.place|upper}}
                            </p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Базовая монета" %}</p>
                            <p class="top-strategies__info-value">
                                <img src="{% static 'img/icons/usdt.svg' %}" alt="USDT logo">
                                {{el.stats.main_symbol}}
                            </p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Общая прибыль" %}</p>
                            <p class="top-strategies__info-value top-strategies__info-value_num">
                                {{el.stats.month_ROE}}%</p>
                        </li>
                    </ul>
                    <div class="top-strategies__chart" data-chart-top-strategies></div>
                    <ul class="top-strategies__info">
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Риски" %}</p>
                            <p class="top-strategies__info-value">{{el.stats.risk}}%</p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Тип" %}</p>
                            <p class="top-strategies__info-value">{{el.type}}</p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Сделок в месяц" %}</p>
                            <p class="top-strategies__info-value top-strategies__info-value_num">
                                <img src="{% static 'img/icons/crown.png' %}" alt="Crown">
                                {{el.stats.month_count}}
                            </p>
                        </li>
                    </ul>
                </a>
                {% endfor %}
                {% comment %}
                <li class="top-strategies__item">
                    <p class="top-strategies__verification">{% translate "Верифицированный трейдер" %}</p>
                    <h3 class="top-strategies__title">
                        <img src="{% static 'img/icons/checkmark-2.svg' %}" alt="Checkmark Icon">
                        Daddy Trading
                    </h3>
                    <ul class="top-strategies__info">
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Обмен" %}</p>
                            <p class="top-strategies__info-value">
                                <img src="{% static 'img/icons/binance-2.svg' %}" alt="Binance logo">
                                BINANCE
                            </p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Базовая монета" %}</p>
                            <p class="top-strategies__info-value">
                                <img src="{% static 'img/icons/usdt.svg' %}" alt="USDT logo">
                                USDT
                            </p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Общая прибыль" %}</p>
                            <p class="top-strategies__info-value top-strategies__info-value_num">+261.00%</p>
                        </li>
                    </ul>
                    <div class="top-strategies__chart" data-chart-top-strategies></div>
                    <ul class="top-strategies__info">
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Риски" %}</p>
                            <p class="top-strategies__info-value">2.1</p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Тип" %}</p>
                            <p class="top-strategies__info-value">Spot</p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Рейтинг" %}</p>
                            <p class="top-strategies__info-value top-strategies__info-value_num">
                                <img src="{% static 'img/icons/crown.png' %}" alt="Crown">
                                8.9
                            </p>
                        </li>
                    </ul>
                </li>
                <li class="top-strategies__item">
                    <p class="top-strategies__verification">{% translate "Верифицированный трейдер" %}</p>
                    <h3 class="top-strategies__title">
                        <img src="{% static 'img/icons/checkmark-2.svg' %}" alt="Checkmark Icon">
                        Daddy Trading
                    </h3>
                    <ul class="top-strategies__info">
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Обмен" %}</p>
                            <p class="top-strategies__info-value">
                                <img src="{% static 'img/icons/binance-2.svg' %}" alt="Binance logo">
                                BINANCE
                            </p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Базовая монета" %}</p>
                            <p class="top-strategies__info-value">
                                <img src="{% static 'img/icons/usdt.svg' %}" alt="USDT logo">
                                USDT
                            </p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Общая прибыль" %}</p>
                            <p class="top-strategies__info-value top-strategies__info-value_num">+261.00%</p>
                        </li>
                    </ul>
                    <div class="top-strategies__chart" data-chart-top-strategies></div>
                    <ul class="top-strategies__info">
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Риски" %}</p>
                            <p class="top-strategies__info-value">2.1</p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Тип" %}</p>
                            <p class="top-strategies__info-value">Spot</p>
                        </li>
                        <li class="top-strategies__info-item">
                            <p class="top-strategies__info-name">{% translate "Рейтинг" %}</p>
                            <p class="top-strategies__info-value top-strategies__info-value_num">
                                <img src="{% static 'img/icons/crown.png' %}" alt="Crown">
                                8.9
                            </p>
                        </li>
                    </ul>
                </li>
                {% endcomment %}
            </ul>
        </div>
    </section>
    <section class="section-all-strategies" style="padding: 20px 20px 110px 20px">
        <div class="d-balance__table" >
            <div class="d-balance__table-title"> {% trans 'Все стратегии' %}</div>
            <div class="d-balance__table-header">
                <div class="d-balance__table-header-item">
                    <div class="d-balance__table-header-item-title">{% trans 'Биржа' %}</div>
                    <div class="custom-select d-balance__table-header-item-select">
                        <select name="select" class="custom-select__select-default">
                            <option value="Все операции">{% trans 'Все' %}</option>
                            <option value="Все операции">{% trans 'Binance' %}</option>
                            <option value="Все операции">{% trans 'BiByt' %}</option>
                        </select>
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                             class="custom-select__arrow">
                            <path fill-rule="evenodd" d="M0.0,0.0 L6.727,6.727 L13.454,0.0 L0.0,0.0 Z"/>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="d-table d-balance__table-el">
                <div class="d-table__row d-table__row--header">
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">{% trans 'Стратегия' %}</div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">{% trans 'Биржа' %}</div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">{% trans 'Тип' %}</div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">
                            <div class="d-table__row-col-inner">{% trans 'Основная монета' %}</div>
                        </div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">
                            <div class="d-table__row-col-inner">{% trans 'Риски' %}</div>
                        </div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">
                            <div class="d-table__row-col-inner">{% trans 'Колличество сделок(Месяц)' %}</div>
                        </div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">
                            <div class="d-table__row-col-inner">{% trans 'Процент верных' %}</div>
                        </div>
                    </div>
                    <div class="d-table__row-col">
                        <div class="d-table__row-col-inner">
                            <div class="d-table__row-col-inner">Рост/Падение</div>
                        </div>
                    </div>
                </div>
                {% comment %} Строки таблицы {% endcomment %}
                {% for el in strategyes %}
                <a style="color: black;" href="{% url 'appStrategyId' el.id %}" class="d-table__row d-table__row--body {% if el.status == False %} d-table__row--disabled {% endif %}">
                    <div class="d-table__row-col" data-table-title="{% trans 'Стратегия' %}">
                        <div class="d-table__row-col-inner">
                            <div class="d-strategy__row-col-inner">

                                <img style="padding-right: 5px" src="{% static 'img/icons/checkmark.svg' %}"
                                     alt="Checkmark Icon">
                                <div>{{el.title}}</div>
                            </div>

                        </div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Биржа' %}">
                        <div class="d-table__row-col-inner">
                            <div class="d-strategy__row-col-inner">
                                {% if el.platforms.place == "Binance" %}
                                <img style="max-width: 25px; padding-right: 5px"
                                     src="{% static 'img/icons/binance-2.svg' %}" alt="Binance logo">
                                {{el.platforms.place|upper}}
                                {%else%}
                                <img style="max-width: 25px; padding-right: 5px"
                                     src="{% static 'img/icons/binance-2.svg' %}" alt="Binance logo">
                                {{el.platforms.place|upper}}
                                {%endif%}
                            </div>
                        </div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Тип' %}">

                        <div class="d-table__row-col-inner d-strategy__row-col-inner">{{el.type}}</div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Основная монета' %}">
                        <div class="d-table__row-col-inner d-strategy__row-col-inner">{{el.stats.main_symbol}}</div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Риски' %}">
                        <div class="d-table__row-col-inner d-strategy__row-col-inner">{{el.stats.risk}}%</div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Колличество сделок(Месяц)' %}">
                        <div class="d-table__row-col-inner d-strategy__row-col-inner">{{el.stats.month_count}}</div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Процент верных' %}">
                        <div class="d-table__row-col-inner d-strategy__row-col-inner">{{el.stats.count_true_ROE}}</div>
                    </div>
                    <div class="d-table__row-col" data-table-title="{% trans 'Рост/Падение' %}">
                        <div class="d-table__row-col-inner">
                            <div class="d-strategy__row-col-inner">

                                <td class="table-strategies__cell-chart">
                                    <div style="display: flex;align-items: center;justify-content: flex-end;">
                                        {{el.stats.month_ROE}}%
                                        <div style="width: 75px;" orders="{{el.stats.all_ROE}}"
                                             data-chart-all-strategies="green"
                                             class="table-strategies__chart"></div>
                                    </div>
                                </td>
                            </div>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    // Top strategies charts
    (() => {
        const data = []
        for (el of document.getElementsByClassName('top-strategies__item')) {
            orders = el.getAttribute('orders').replace('[', '').replace(']', '').split(', ')
            data.push(orders)
        }

        const chartConfig = {
            chart: {
                height: 160,
                type: 'line',
                parentHeightOffset: 0,
                toolbar: {
                    show: false
                },
                zoom: {
                    enabled: false
                }
            },
            stroke: {
                width: 2
            },
            dataLabels: {
                enabled: false
            },
            colors: ['#64fdec'],
            grid: {
                show: false,
                padding: {
                    top: 0,
                    right: 0,
                    bottom: 0,
                    left: -10
                }
            },
            tooltip: {
                enabled: false
            },
            xaxis: {
                labels: {
                    show: false
                },
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false
                },
                tooltip: {
                    enabled: false
                },
            },
            yaxis: {
                labels: {
                    show: false
                },
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false
                },
                tooltip: {
                    enabled: false
                },
            }
        };

        const chartsTopStrategies = document.querySelectorAll('[data-chart-top-strategies]');

        chartsTopStrategies.forEach((chart, i) => {
            new ApexCharts(chart, {
                ...chartConfig,
                series: [{
                    data: data[i]
                }]
            }).render();
        })
    })();

    // All strategies charts
    (() => {
        const data = []
        for (el of document.getElementsByClassName('table-strategies__chart')) {
            orders = el.getAttribute('orders').replace('[', '').replace(']', '').split(', ')
            data.push(orders)
        }
        const chartConfig = {
            chart: {
                height: 80,
                type: 'line',
                parentHeightOffset: 0,
                toolbar: {
                    show: false
                },
                zoom: {
                    enabled: false
                }
            },
            stroke: {
                width: 2
            },
            dataLabels: {
                enabled: false
            },
            grid: {
                show: false,
                padding: {
                    top: 0,
                    right: 0,
                    bottom: 0,
                    left: -10
                }
            },
            tooltip: {
                enabled: false
            },
            xaxis: {
                labels: {
                    show: false
                },
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false
                },
                tooltip: {
                    enabled: false
                },
            },
            yaxis: {
                labels: {
                    show: false
                },
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false
                },
                tooltip: {
                    enabled: false
                },
            }
        };

        const chartsTopStrategies = document.querySelectorAll('[data-chart-all-strategies]');

        chartsTopStrategies.forEach((chart, i) => {
            if (chart.dataset.chartAllStrategies === 'green') {
                chartConfig.colors = ['#64fdec'];
            }

            if (chart.dataset.chartAllStrategies === 'red') {
                chartConfig.colors = ['#fd6464'];
            }

            new ApexCharts(chart, {
                ...chartConfig,
                series: [{
                    data: data[i]
                }]
            }).render();
        })
    })();

</script>
{% endblock %}
